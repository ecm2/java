<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaDocs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="JavaDocs">
    
    <link rel="preload" href="/JavaDocs/assets/css/0.styles.c70d726d.css" as="style"><link rel="preload" href="/JavaDocs/assets/js/app.658ffc6e.js" as="script"><link rel="preload" href="/JavaDocs/assets/js/6.f90b4eae.js" as="script"><link rel="preload" href="/JavaDocs/assets/js/428.900d8293.js" as="script"><link rel="prefetch" href="/JavaDocs/assets/js/10.0bcc95a8.js"><link rel="prefetch" href="/JavaDocs/assets/js/100.a9361a0d.js"><link rel="prefetch" href="/JavaDocs/assets/js/101.49cf4bb4.js"><link rel="prefetch" href="/JavaDocs/assets/js/102.bf9e596b.js"><link rel="prefetch" href="/JavaDocs/assets/js/103.ceffa756.js"><link rel="prefetch" href="/JavaDocs/assets/js/104.7d109751.js"><link rel="prefetch" href="/JavaDocs/assets/js/105.50401740.js"><link rel="prefetch" href="/JavaDocs/assets/js/106.631d1fa4.js"><link rel="prefetch" href="/JavaDocs/assets/js/107.746fdea3.js"><link rel="prefetch" href="/JavaDocs/assets/js/108.2cc8f8a3.js"><link rel="prefetch" href="/JavaDocs/assets/js/109.062e0913.js"><link rel="prefetch" href="/JavaDocs/assets/js/11.75619bd2.js"><link rel="prefetch" href="/JavaDocs/assets/js/110.097f564c.js"><link rel="prefetch" href="/JavaDocs/assets/js/111.d5406b7c.js"><link rel="prefetch" href="/JavaDocs/assets/js/112.e541fdea.js"><link rel="prefetch" href="/JavaDocs/assets/js/113.b1e0d1b5.js"><link rel="prefetch" href="/JavaDocs/assets/js/114.b74c9906.js"><link rel="prefetch" href="/JavaDocs/assets/js/115.afa775bd.js"><link rel="prefetch" href="/JavaDocs/assets/js/116.a160b0c7.js"><link rel="prefetch" href="/JavaDocs/assets/js/117.e6892054.js"><link rel="prefetch" href="/JavaDocs/assets/js/118.349c9291.js"><link rel="prefetch" href="/JavaDocs/assets/js/119.a36386d8.js"><link rel="prefetch" href="/JavaDocs/assets/js/12.462e297a.js"><link rel="prefetch" href="/JavaDocs/assets/js/120.1f7eb600.js"><link rel="prefetch" href="/JavaDocs/assets/js/121.54a3fd8e.js"><link rel="prefetch" href="/JavaDocs/assets/js/122.50b6b6f7.js"><link rel="prefetch" href="/JavaDocs/assets/js/123.ecd4680d.js"><link rel="prefetch" href="/JavaDocs/assets/js/124.d61974df.js"><link rel="prefetch" href="/JavaDocs/assets/js/125.f3f45a92.js"><link rel="prefetch" href="/JavaDocs/assets/js/126.94eb5b0a.js"><link rel="prefetch" href="/JavaDocs/assets/js/127.f41a20b7.js"><link rel="prefetch" href="/JavaDocs/assets/js/128.498509be.js"><link rel="prefetch" href="/JavaDocs/assets/js/129.c41e4c3b.js"><link rel="prefetch" href="/JavaDocs/assets/js/13.d4734342.js"><link rel="prefetch" href="/JavaDocs/assets/js/130.ce81961f.js"><link rel="prefetch" href="/JavaDocs/assets/js/131.7da4afba.js"><link rel="prefetch" href="/JavaDocs/assets/js/132.e37384b5.js"><link rel="prefetch" href="/JavaDocs/assets/js/133.c9de65f1.js"><link rel="prefetch" href="/JavaDocs/assets/js/134.77647e4c.js"><link rel="prefetch" href="/JavaDocs/assets/js/135.757550a6.js"><link rel="prefetch" href="/JavaDocs/assets/js/136.259c43b3.js"><link rel="prefetch" href="/JavaDocs/assets/js/137.1f1cdfec.js"><link rel="prefetch" href="/JavaDocs/assets/js/138.e052ab5d.js"><link rel="prefetch" href="/JavaDocs/assets/js/139.aa8c3ff6.js"><link rel="prefetch" href="/JavaDocs/assets/js/14.6c2f9c48.js"><link rel="prefetch" href="/JavaDocs/assets/js/140.60d7a558.js"><link rel="prefetch" href="/JavaDocs/assets/js/141.aeadcbce.js"><link rel="prefetch" href="/JavaDocs/assets/js/142.9251a337.js"><link rel="prefetch" href="/JavaDocs/assets/js/143.ac3043fb.js"><link rel="prefetch" href="/JavaDocs/assets/js/144.264ae490.js"><link rel="prefetch" href="/JavaDocs/assets/js/145.02d1aff6.js"><link rel="prefetch" href="/JavaDocs/assets/js/146.d434d8d1.js"><link rel="prefetch" href="/JavaDocs/assets/js/147.062e6752.js"><link rel="prefetch" href="/JavaDocs/assets/js/148.57752085.js"><link rel="prefetch" href="/JavaDocs/assets/js/149.7c89b683.js"><link rel="prefetch" href="/JavaDocs/assets/js/15.3b9f3c37.js"><link rel="prefetch" href="/JavaDocs/assets/js/150.b6aba053.js"><link rel="prefetch" href="/JavaDocs/assets/js/151.49889891.js"><link rel="prefetch" href="/JavaDocs/assets/js/152.26ad1c7c.js"><link rel="prefetch" href="/JavaDocs/assets/js/153.cc9c2cf5.js"><link rel="prefetch" href="/JavaDocs/assets/js/154.7102f12d.js"><link rel="prefetch" href="/JavaDocs/assets/js/155.c1430eef.js"><link rel="prefetch" href="/JavaDocs/assets/js/156.fa7baf07.js"><link rel="prefetch" href="/JavaDocs/assets/js/157.672e9235.js"><link rel="prefetch" href="/JavaDocs/assets/js/158.f4f8eb2d.js"><link rel="prefetch" href="/JavaDocs/assets/js/159.0117effa.js"><link rel="prefetch" href="/JavaDocs/assets/js/16.d8e52c48.js"><link rel="prefetch" href="/JavaDocs/assets/js/160.9182979a.js"><link rel="prefetch" href="/JavaDocs/assets/js/161.8ec6dfb6.js"><link rel="prefetch" href="/JavaDocs/assets/js/162.6ec95b09.js"><link rel="prefetch" href="/JavaDocs/assets/js/163.0827e46d.js"><link rel="prefetch" href="/JavaDocs/assets/js/164.889931f1.js"><link rel="prefetch" href="/JavaDocs/assets/js/165.c09490f1.js"><link rel="prefetch" href="/JavaDocs/assets/js/166.85fada0f.js"><link rel="prefetch" href="/JavaDocs/assets/js/167.7c8afa58.js"><link rel="prefetch" href="/JavaDocs/assets/js/168.3b6e4ad5.js"><link rel="prefetch" href="/JavaDocs/assets/js/169.21de6632.js"><link rel="prefetch" href="/JavaDocs/assets/js/17.ff650d66.js"><link rel="prefetch" href="/JavaDocs/assets/js/170.be0280a0.js"><link rel="prefetch" href="/JavaDocs/assets/js/171.6f49a328.js"><link rel="prefetch" href="/JavaDocs/assets/js/172.13d18ff0.js"><link rel="prefetch" href="/JavaDocs/assets/js/173.e60ea81b.js"><link rel="prefetch" href="/JavaDocs/assets/js/174.4c4f5b3a.js"><link rel="prefetch" href="/JavaDocs/assets/js/175.5dcc2196.js"><link rel="prefetch" href="/JavaDocs/assets/js/176.53236896.js"><link rel="prefetch" href="/JavaDocs/assets/js/177.d90caf35.js"><link rel="prefetch" href="/JavaDocs/assets/js/178.f6bc701f.js"><link rel="prefetch" href="/JavaDocs/assets/js/179.8d1f0576.js"><link rel="prefetch" href="/JavaDocs/assets/js/18.fd9821e2.js"><link rel="prefetch" href="/JavaDocs/assets/js/180.a5531e3d.js"><link rel="prefetch" href="/JavaDocs/assets/js/181.38860fe8.js"><link rel="prefetch" href="/JavaDocs/assets/js/182.7ed9910e.js"><link rel="prefetch" href="/JavaDocs/assets/js/183.abe23b60.js"><link rel="prefetch" href="/JavaDocs/assets/js/184.85b47188.js"><link rel="prefetch" href="/JavaDocs/assets/js/185.2921fd3d.js"><link rel="prefetch" href="/JavaDocs/assets/js/186.b52fc7fc.js"><link rel="prefetch" href="/JavaDocs/assets/js/187.434acc03.js"><link rel="prefetch" href="/JavaDocs/assets/js/188.bc9e1079.js"><link rel="prefetch" href="/JavaDocs/assets/js/189.78343c95.js"><link rel="prefetch" href="/JavaDocs/assets/js/19.dc13bfc7.js"><link rel="prefetch" href="/JavaDocs/assets/js/190.0a338072.js"><link rel="prefetch" href="/JavaDocs/assets/js/191.de9c4b7e.js"><link rel="prefetch" href="/JavaDocs/assets/js/192.d377e03a.js"><link rel="prefetch" href="/JavaDocs/assets/js/193.5697de77.js"><link rel="prefetch" href="/JavaDocs/assets/js/194.054a5d15.js"><link rel="prefetch" href="/JavaDocs/assets/js/195.c9246456.js"><link rel="prefetch" href="/JavaDocs/assets/js/196.3291c3a9.js"><link rel="prefetch" href="/JavaDocs/assets/js/197.c163cd11.js"><link rel="prefetch" href="/JavaDocs/assets/js/198.829fe8fe.js"><link rel="prefetch" href="/JavaDocs/assets/js/199.5654cc94.js"><link rel="prefetch" href="/JavaDocs/assets/js/2.6ff229a6.js"><link rel="prefetch" href="/JavaDocs/assets/js/20.573d74f4.js"><link rel="prefetch" href="/JavaDocs/assets/js/200.2e5e88f6.js"><link rel="prefetch" href="/JavaDocs/assets/js/201.9b600317.js"><link rel="prefetch" href="/JavaDocs/assets/js/202.261cdf5f.js"><link rel="prefetch" href="/JavaDocs/assets/js/203.500045b2.js"><link rel="prefetch" href="/JavaDocs/assets/js/204.cc3e1214.js"><link rel="prefetch" href="/JavaDocs/assets/js/205.ac0faa2a.js"><link rel="prefetch" href="/JavaDocs/assets/js/206.c87a2f0c.js"><link rel="prefetch" href="/JavaDocs/assets/js/207.1e38bc0a.js"><link rel="prefetch" href="/JavaDocs/assets/js/208.26cbb6af.js"><link rel="prefetch" href="/JavaDocs/assets/js/209.647196a1.js"><link rel="prefetch" href="/JavaDocs/assets/js/21.1419ff17.js"><link rel="prefetch" href="/JavaDocs/assets/js/210.c7832a15.js"><link rel="prefetch" href="/JavaDocs/assets/js/211.49e2373f.js"><link rel="prefetch" href="/JavaDocs/assets/js/212.7c6bbef4.js"><link rel="prefetch" href="/JavaDocs/assets/js/213.3f7afdc6.js"><link rel="prefetch" href="/JavaDocs/assets/js/214.5f2cc1b7.js"><link rel="prefetch" href="/JavaDocs/assets/js/215.2bdc3200.js"><link rel="prefetch" href="/JavaDocs/assets/js/216.a70b16a8.js"><link rel="prefetch" href="/JavaDocs/assets/js/217.05369f81.js"><link rel="prefetch" href="/JavaDocs/assets/js/218.119c74be.js"><link rel="prefetch" href="/JavaDocs/assets/js/219.5bd1ed58.js"><link rel="prefetch" href="/JavaDocs/assets/js/22.141ea614.js"><link rel="prefetch" href="/JavaDocs/assets/js/220.2a1c4833.js"><link rel="prefetch" href="/JavaDocs/assets/js/221.dcdef117.js"><link rel="prefetch" href="/JavaDocs/assets/js/222.cbbb0be4.js"><link rel="prefetch" href="/JavaDocs/assets/js/223.a4a42c65.js"><link rel="prefetch" href="/JavaDocs/assets/js/224.e877c54a.js"><link rel="prefetch" href="/JavaDocs/assets/js/225.14e8c0dc.js"><link rel="prefetch" href="/JavaDocs/assets/js/226.cd924613.js"><link rel="prefetch" href="/JavaDocs/assets/js/227.f3966eb1.js"><link rel="prefetch" href="/JavaDocs/assets/js/228.c973c2c3.js"><link rel="prefetch" href="/JavaDocs/assets/js/229.138a09e2.js"><link rel="prefetch" href="/JavaDocs/assets/js/23.331211dd.js"><link rel="prefetch" href="/JavaDocs/assets/js/230.8e759226.js"><link rel="prefetch" href="/JavaDocs/assets/js/231.a821f467.js"><link rel="prefetch" href="/JavaDocs/assets/js/232.ab4cbf77.js"><link rel="prefetch" href="/JavaDocs/assets/js/233.03e753a5.js"><link rel="prefetch" href="/JavaDocs/assets/js/234.8bbeb7bb.js"><link rel="prefetch" href="/JavaDocs/assets/js/235.5feccd00.js"><link rel="prefetch" href="/JavaDocs/assets/js/236.fea479b1.js"><link rel="prefetch" href="/JavaDocs/assets/js/237.65fc5d1a.js"><link rel="prefetch" href="/JavaDocs/assets/js/238.00ea30df.js"><link rel="prefetch" href="/JavaDocs/assets/js/239.0c90f196.js"><link rel="prefetch" href="/JavaDocs/assets/js/24.e65cf25c.js"><link rel="prefetch" href="/JavaDocs/assets/js/240.2b8ed2ae.js"><link rel="prefetch" href="/JavaDocs/assets/js/241.4d7fee7b.js"><link rel="prefetch" href="/JavaDocs/assets/js/242.6cdb5aa6.js"><link rel="prefetch" href="/JavaDocs/assets/js/243.be1172bb.js"><link rel="prefetch" href="/JavaDocs/assets/js/244.baee9e74.js"><link rel="prefetch" href="/JavaDocs/assets/js/245.7f278970.js"><link rel="prefetch" href="/JavaDocs/assets/js/246.ea2e6425.js"><link rel="prefetch" href="/JavaDocs/assets/js/247.aab18b5a.js"><link rel="prefetch" href="/JavaDocs/assets/js/248.6ecc5566.js"><link rel="prefetch" href="/JavaDocs/assets/js/249.65069e52.js"><link rel="prefetch" href="/JavaDocs/assets/js/25.6b9ef154.js"><link rel="prefetch" href="/JavaDocs/assets/js/250.971cab81.js"><link rel="prefetch" href="/JavaDocs/assets/js/251.51fa0313.js"><link rel="prefetch" href="/JavaDocs/assets/js/252.0f71db6a.js"><link rel="prefetch" href="/JavaDocs/assets/js/253.8f2652bf.js"><link rel="prefetch" href="/JavaDocs/assets/js/254.61c2b957.js"><link rel="prefetch" href="/JavaDocs/assets/js/255.3612f769.js"><link rel="prefetch" href="/JavaDocs/assets/js/256.751e3ae5.js"><link rel="prefetch" href="/JavaDocs/assets/js/257.63b5b8c8.js"><link rel="prefetch" href="/JavaDocs/assets/js/258.d518e728.js"><link rel="prefetch" href="/JavaDocs/assets/js/259.ba87ae6a.js"><link rel="prefetch" href="/JavaDocs/assets/js/26.71df977f.js"><link rel="prefetch" href="/JavaDocs/assets/js/260.26747de9.js"><link rel="prefetch" href="/JavaDocs/assets/js/261.7a9f8d02.js"><link rel="prefetch" href="/JavaDocs/assets/js/262.4bc88efa.js"><link rel="prefetch" href="/JavaDocs/assets/js/263.e82081cc.js"><link rel="prefetch" href="/JavaDocs/assets/js/264.07aca442.js"><link rel="prefetch" href="/JavaDocs/assets/js/265.da7ca769.js"><link rel="prefetch" href="/JavaDocs/assets/js/266.f7153b07.js"><link rel="prefetch" href="/JavaDocs/assets/js/267.25a94dbe.js"><link rel="prefetch" href="/JavaDocs/assets/js/268.a704810a.js"><link rel="prefetch" href="/JavaDocs/assets/js/269.797e64fb.js"><link rel="prefetch" href="/JavaDocs/assets/js/27.03a2bc9f.js"><link rel="prefetch" href="/JavaDocs/assets/js/270.a8fc6da3.js"><link rel="prefetch" href="/JavaDocs/assets/js/271.6d7bfb0e.js"><link rel="prefetch" href="/JavaDocs/assets/js/272.fcd63ae5.js"><link rel="prefetch" href="/JavaDocs/assets/js/273.8472d7b8.js"><link rel="prefetch" href="/JavaDocs/assets/js/274.2d030486.js"><link rel="prefetch" href="/JavaDocs/assets/js/275.35c65e95.js"><link rel="prefetch" href="/JavaDocs/assets/js/276.08402c57.js"><link rel="prefetch" href="/JavaDocs/assets/js/277.2b2bdfe9.js"><link rel="prefetch" href="/JavaDocs/assets/js/278.0b40c2b1.js"><link rel="prefetch" href="/JavaDocs/assets/js/279.c3e2323f.js"><link rel="prefetch" href="/JavaDocs/assets/js/28.660cf192.js"><link rel="prefetch" href="/JavaDocs/assets/js/280.0dcde6ca.js"><link rel="prefetch" href="/JavaDocs/assets/js/281.1d79cbec.js"><link rel="prefetch" href="/JavaDocs/assets/js/282.19406cca.js"><link rel="prefetch" href="/JavaDocs/assets/js/283.88dba197.js"><link rel="prefetch" href="/JavaDocs/assets/js/284.adfe8677.js"><link rel="prefetch" href="/JavaDocs/assets/js/285.2b9ddc25.js"><link rel="prefetch" href="/JavaDocs/assets/js/286.a82c427b.js"><link rel="prefetch" href="/JavaDocs/assets/js/287.0cf41b14.js"><link rel="prefetch" href="/JavaDocs/assets/js/288.f46e39dc.js"><link rel="prefetch" href="/JavaDocs/assets/js/289.5b097c03.js"><link rel="prefetch" href="/JavaDocs/assets/js/29.4c533b93.js"><link rel="prefetch" href="/JavaDocs/assets/js/290.f9b0d9b1.js"><link rel="prefetch" href="/JavaDocs/assets/js/291.9fd8c448.js"><link rel="prefetch" href="/JavaDocs/assets/js/292.ba1ce130.js"><link rel="prefetch" href="/JavaDocs/assets/js/293.b317af38.js"><link rel="prefetch" href="/JavaDocs/assets/js/294.4c76a573.js"><link rel="prefetch" href="/JavaDocs/assets/js/295.c7073f5d.js"><link rel="prefetch" href="/JavaDocs/assets/js/296.56852aa8.js"><link rel="prefetch" href="/JavaDocs/assets/js/297.62843d30.js"><link rel="prefetch" href="/JavaDocs/assets/js/298.d8203765.js"><link rel="prefetch" href="/JavaDocs/assets/js/299.893ae364.js"><link rel="prefetch" href="/JavaDocs/assets/js/3.b71d113b.js"><link rel="prefetch" href="/JavaDocs/assets/js/30.ef36ccaa.js"><link rel="prefetch" href="/JavaDocs/assets/js/300.371ae16e.js"><link rel="prefetch" href="/JavaDocs/assets/js/301.c6ec8ea5.js"><link rel="prefetch" href="/JavaDocs/assets/js/302.886f50ba.js"><link rel="prefetch" href="/JavaDocs/assets/js/303.b67bb3a3.js"><link rel="prefetch" href="/JavaDocs/assets/js/304.f4c1f794.js"><link rel="prefetch" href="/JavaDocs/assets/js/305.8cc41535.js"><link rel="prefetch" href="/JavaDocs/assets/js/306.4576ddfb.js"><link rel="prefetch" href="/JavaDocs/assets/js/307.dfec7bf6.js"><link rel="prefetch" href="/JavaDocs/assets/js/308.193b5f6d.js"><link rel="prefetch" href="/JavaDocs/assets/js/309.c37d3eed.js"><link rel="prefetch" href="/JavaDocs/assets/js/31.dbccf84f.js"><link rel="prefetch" href="/JavaDocs/assets/js/310.4f73199f.js"><link rel="prefetch" href="/JavaDocs/assets/js/311.2fa04338.js"><link rel="prefetch" href="/JavaDocs/assets/js/312.078c91cb.js"><link rel="prefetch" href="/JavaDocs/assets/js/313.2998ae57.js"><link rel="prefetch" href="/JavaDocs/assets/js/314.64cfc218.js"><link rel="prefetch" href="/JavaDocs/assets/js/315.601a2cd9.js"><link rel="prefetch" href="/JavaDocs/assets/js/316.8eb017bb.js"><link rel="prefetch" href="/JavaDocs/assets/js/317.c28bb5ad.js"><link rel="prefetch" href="/JavaDocs/assets/js/318.9612aaa7.js"><link rel="prefetch" href="/JavaDocs/assets/js/319.fb58c54e.js"><link rel="prefetch" href="/JavaDocs/assets/js/32.9456db31.js"><link rel="prefetch" href="/JavaDocs/assets/js/320.f45ad8a9.js"><link rel="prefetch" href="/JavaDocs/assets/js/321.e0ded72b.js"><link rel="prefetch" href="/JavaDocs/assets/js/322.ab5ecb28.js"><link rel="prefetch" href="/JavaDocs/assets/js/323.9e4fa306.js"><link rel="prefetch" href="/JavaDocs/assets/js/324.de95e185.js"><link rel="prefetch" href="/JavaDocs/assets/js/325.4df88edf.js"><link rel="prefetch" href="/JavaDocs/assets/js/326.3158915c.js"><link rel="prefetch" href="/JavaDocs/assets/js/327.ffdf468c.js"><link rel="prefetch" href="/JavaDocs/assets/js/328.431b7399.js"><link rel="prefetch" href="/JavaDocs/assets/js/329.3add1306.js"><link rel="prefetch" href="/JavaDocs/assets/js/33.14ca1bc8.js"><link rel="prefetch" href="/JavaDocs/assets/js/330.3482546f.js"><link rel="prefetch" href="/JavaDocs/assets/js/331.ca35b945.js"><link rel="prefetch" href="/JavaDocs/assets/js/332.9b1da34e.js"><link rel="prefetch" href="/JavaDocs/assets/js/333.1f1ae70d.js"><link rel="prefetch" href="/JavaDocs/assets/js/334.24910f9d.js"><link rel="prefetch" href="/JavaDocs/assets/js/335.82203c90.js"><link rel="prefetch" href="/JavaDocs/assets/js/336.6c07fd3d.js"><link rel="prefetch" href="/JavaDocs/assets/js/337.9f9c864d.js"><link rel="prefetch" href="/JavaDocs/assets/js/338.e75dab44.js"><link rel="prefetch" href="/JavaDocs/assets/js/339.7682e6bf.js"><link rel="prefetch" href="/JavaDocs/assets/js/34.6c2c5603.js"><link rel="prefetch" href="/JavaDocs/assets/js/340.9f7a54d7.js"><link rel="prefetch" href="/JavaDocs/assets/js/341.b07e06ba.js"><link rel="prefetch" href="/JavaDocs/assets/js/342.4ea48f8d.js"><link rel="prefetch" href="/JavaDocs/assets/js/343.58cff14f.js"><link rel="prefetch" href="/JavaDocs/assets/js/344.b7765355.js"><link rel="prefetch" href="/JavaDocs/assets/js/345.b71b7bac.js"><link rel="prefetch" href="/JavaDocs/assets/js/346.d64d3f4a.js"><link rel="prefetch" href="/JavaDocs/assets/js/347.8424c530.js"><link rel="prefetch" href="/JavaDocs/assets/js/348.a6da77e6.js"><link rel="prefetch" href="/JavaDocs/assets/js/349.7a00a6cc.js"><link rel="prefetch" href="/JavaDocs/assets/js/35.815e0544.js"><link rel="prefetch" href="/JavaDocs/assets/js/350.d55f5468.js"><link rel="prefetch" href="/JavaDocs/assets/js/351.84b23cd9.js"><link rel="prefetch" href="/JavaDocs/assets/js/352.301b2cea.js"><link rel="prefetch" href="/JavaDocs/assets/js/353.b6277d1a.js"><link rel="prefetch" href="/JavaDocs/assets/js/354.18e86855.js"><link rel="prefetch" href="/JavaDocs/assets/js/355.6d17074e.js"><link rel="prefetch" href="/JavaDocs/assets/js/356.e139fbcd.js"><link rel="prefetch" href="/JavaDocs/assets/js/357.3e9826bd.js"><link rel="prefetch" href="/JavaDocs/assets/js/358.8be1624e.js"><link rel="prefetch" href="/JavaDocs/assets/js/359.053f9d14.js"><link rel="prefetch" href="/JavaDocs/assets/js/36.cb2191f1.js"><link rel="prefetch" href="/JavaDocs/assets/js/360.e6890582.js"><link rel="prefetch" href="/JavaDocs/assets/js/361.b119b8fc.js"><link rel="prefetch" href="/JavaDocs/assets/js/362.6366bc36.js"><link rel="prefetch" href="/JavaDocs/assets/js/363.8a787c09.js"><link rel="prefetch" href="/JavaDocs/assets/js/364.a5e0bbac.js"><link rel="prefetch" href="/JavaDocs/assets/js/365.ba648759.js"><link rel="prefetch" href="/JavaDocs/assets/js/366.369c9956.js"><link rel="prefetch" href="/JavaDocs/assets/js/367.79e82dc8.js"><link rel="prefetch" href="/JavaDocs/assets/js/368.ee35c0c8.js"><link rel="prefetch" href="/JavaDocs/assets/js/369.3befbc83.js"><link rel="prefetch" href="/JavaDocs/assets/js/37.6f08a8d1.js"><link rel="prefetch" href="/JavaDocs/assets/js/370.4d418100.js"><link rel="prefetch" href="/JavaDocs/assets/js/371.8d5f734f.js"><link rel="prefetch" href="/JavaDocs/assets/js/372.0c0a6cde.js"><link rel="prefetch" href="/JavaDocs/assets/js/373.74c4530c.js"><link rel="prefetch" href="/JavaDocs/assets/js/374.5d16efc4.js"><link rel="prefetch" href="/JavaDocs/assets/js/375.062b2d86.js"><link rel="prefetch" href="/JavaDocs/assets/js/376.2a829083.js"><link rel="prefetch" href="/JavaDocs/assets/js/377.5a6dd3e5.js"><link rel="prefetch" href="/JavaDocs/assets/js/378.76e0763c.js"><link rel="prefetch" href="/JavaDocs/assets/js/379.ca816539.js"><link rel="prefetch" href="/JavaDocs/assets/js/38.661bb6f0.js"><link rel="prefetch" href="/JavaDocs/assets/js/380.277e0fcf.js"><link rel="prefetch" href="/JavaDocs/assets/js/381.497f6ab4.js"><link rel="prefetch" href="/JavaDocs/assets/js/382.f0ed4228.js"><link rel="prefetch" href="/JavaDocs/assets/js/383.005e0691.js"><link rel="prefetch" href="/JavaDocs/assets/js/384.56d5b93a.js"><link rel="prefetch" href="/JavaDocs/assets/js/385.b83e2fd5.js"><link rel="prefetch" href="/JavaDocs/assets/js/386.06e06816.js"><link rel="prefetch" href="/JavaDocs/assets/js/387.e5d211ca.js"><link rel="prefetch" href="/JavaDocs/assets/js/388.a582207f.js"><link rel="prefetch" href="/JavaDocs/assets/js/389.8387d4f0.js"><link rel="prefetch" href="/JavaDocs/assets/js/39.55143378.js"><link rel="prefetch" href="/JavaDocs/assets/js/390.8d9bf698.js"><link rel="prefetch" href="/JavaDocs/assets/js/391.9886135f.js"><link rel="prefetch" href="/JavaDocs/assets/js/392.a5d4aa66.js"><link rel="prefetch" href="/JavaDocs/assets/js/393.31d1cfd4.js"><link rel="prefetch" href="/JavaDocs/assets/js/394.35451a94.js"><link rel="prefetch" href="/JavaDocs/assets/js/395.e83a3bc7.js"><link rel="prefetch" href="/JavaDocs/assets/js/396.21ceab80.js"><link rel="prefetch" href="/JavaDocs/assets/js/397.1bc35c4f.js"><link rel="prefetch" href="/JavaDocs/assets/js/398.d2bf334f.js"><link rel="prefetch" href="/JavaDocs/assets/js/399.1220aa85.js"><link rel="prefetch" href="/JavaDocs/assets/js/4.c79e99c3.js"><link rel="prefetch" href="/JavaDocs/assets/js/40.82cdc706.js"><link rel="prefetch" href="/JavaDocs/assets/js/400.44c2e42d.js"><link rel="prefetch" href="/JavaDocs/assets/js/401.fa056095.js"><link rel="prefetch" href="/JavaDocs/assets/js/402.169a3779.js"><link rel="prefetch" href="/JavaDocs/assets/js/403.f7ad4a5a.js"><link rel="prefetch" href="/JavaDocs/assets/js/404.a500336e.js"><link rel="prefetch" href="/JavaDocs/assets/js/405.dd28bff2.js"><link rel="prefetch" href="/JavaDocs/assets/js/406.be032a64.js"><link rel="prefetch" href="/JavaDocs/assets/js/407.a2be139b.js"><link rel="prefetch" href="/JavaDocs/assets/js/408.2529e968.js"><link rel="prefetch" href="/JavaDocs/assets/js/409.1df2684e.js"><link rel="prefetch" href="/JavaDocs/assets/js/41.b9ea09b0.js"><link rel="prefetch" href="/JavaDocs/assets/js/410.fffbd4f6.js"><link rel="prefetch" href="/JavaDocs/assets/js/411.8d195189.js"><link rel="prefetch" href="/JavaDocs/assets/js/412.fd52bb57.js"><link rel="prefetch" href="/JavaDocs/assets/js/413.77000904.js"><link rel="prefetch" href="/JavaDocs/assets/js/414.8297e084.js"><link rel="prefetch" href="/JavaDocs/assets/js/415.4dd140aa.js"><link rel="prefetch" href="/JavaDocs/assets/js/416.ccaa498c.js"><link rel="prefetch" href="/JavaDocs/assets/js/417.274dc4e8.js"><link rel="prefetch" href="/JavaDocs/assets/js/418.ea2f190f.js"><link rel="prefetch" href="/JavaDocs/assets/js/419.9e018013.js"><link rel="prefetch" href="/JavaDocs/assets/js/42.57a9b8fb.js"><link rel="prefetch" href="/JavaDocs/assets/js/420.3e1eb571.js"><link rel="prefetch" href="/JavaDocs/assets/js/421.b0799cae.js"><link rel="prefetch" href="/JavaDocs/assets/js/422.a4832894.js"><link rel="prefetch" href="/JavaDocs/assets/js/423.4415d2fa.js"><link rel="prefetch" href="/JavaDocs/assets/js/424.fbd73271.js"><link rel="prefetch" href="/JavaDocs/assets/js/425.0b249940.js"><link rel="prefetch" href="/JavaDocs/assets/js/426.96d3a8f2.js"><link rel="prefetch" href="/JavaDocs/assets/js/427.85bd58c4.js"><link rel="prefetch" href="/JavaDocs/assets/js/429.b6c68f2b.js"><link rel="prefetch" href="/JavaDocs/assets/js/43.eadb6817.js"><link rel="prefetch" href="/JavaDocs/assets/js/430.d315b8de.js"><link rel="prefetch" href="/JavaDocs/assets/js/44.e2e180a0.js"><link rel="prefetch" href="/JavaDocs/assets/js/45.14bef2e9.js"><link rel="prefetch" href="/JavaDocs/assets/js/46.20e6d7cb.js"><link rel="prefetch" href="/JavaDocs/assets/js/47.6490769b.js"><link rel="prefetch" href="/JavaDocs/assets/js/48.8d0f6c05.js"><link rel="prefetch" href="/JavaDocs/assets/js/49.6e6ea1db.js"><link rel="prefetch" href="/JavaDocs/assets/js/5.1036e105.js"><link rel="prefetch" href="/JavaDocs/assets/js/50.607bed9f.js"><link rel="prefetch" href="/JavaDocs/assets/js/51.9df1d377.js"><link rel="prefetch" href="/JavaDocs/assets/js/52.4fa48dcc.js"><link rel="prefetch" href="/JavaDocs/assets/js/53.4f70ff4f.js"><link rel="prefetch" href="/JavaDocs/assets/js/54.8417075e.js"><link rel="prefetch" href="/JavaDocs/assets/js/55.5922fba3.js"><link rel="prefetch" href="/JavaDocs/assets/js/56.ebc8fe88.js"><link rel="prefetch" href="/JavaDocs/assets/js/57.03043374.js"><link rel="prefetch" href="/JavaDocs/assets/js/58.96bb9864.js"><link rel="prefetch" href="/JavaDocs/assets/js/59.3082af8d.js"><link rel="prefetch" href="/JavaDocs/assets/js/60.03acdd20.js"><link rel="prefetch" href="/JavaDocs/assets/js/61.86f5ef19.js"><link rel="prefetch" href="/JavaDocs/assets/js/62.a92ea43d.js"><link rel="prefetch" href="/JavaDocs/assets/js/63.f6ed9421.js"><link rel="prefetch" href="/JavaDocs/assets/js/64.879e9ae5.js"><link rel="prefetch" href="/JavaDocs/assets/js/65.b536d369.js"><link rel="prefetch" href="/JavaDocs/assets/js/66.a39cb5fb.js"><link rel="prefetch" href="/JavaDocs/assets/js/67.87e0d94f.js"><link rel="prefetch" href="/JavaDocs/assets/js/68.166d95a6.js"><link rel="prefetch" href="/JavaDocs/assets/js/69.f0338740.js"><link rel="prefetch" href="/JavaDocs/assets/js/7.4b47abd9.js"><link rel="prefetch" href="/JavaDocs/assets/js/70.ab26fd84.js"><link rel="prefetch" href="/JavaDocs/assets/js/71.5a74af91.js"><link rel="prefetch" href="/JavaDocs/assets/js/72.6debd037.js"><link rel="prefetch" href="/JavaDocs/assets/js/73.f663658a.js"><link rel="prefetch" href="/JavaDocs/assets/js/74.4cea0146.js"><link rel="prefetch" href="/JavaDocs/assets/js/75.33aa54fe.js"><link rel="prefetch" href="/JavaDocs/assets/js/76.5b319770.js"><link rel="prefetch" href="/JavaDocs/assets/js/77.1c4b1209.js"><link rel="prefetch" href="/JavaDocs/assets/js/78.d119c4c9.js"><link rel="prefetch" href="/JavaDocs/assets/js/79.d86af55f.js"><link rel="prefetch" href="/JavaDocs/assets/js/8.362f6bbe.js"><link rel="prefetch" href="/JavaDocs/assets/js/80.1dff0872.js"><link rel="prefetch" href="/JavaDocs/assets/js/81.f34f72d1.js"><link rel="prefetch" href="/JavaDocs/assets/js/82.f44d353b.js"><link rel="prefetch" href="/JavaDocs/assets/js/83.98ae0f3c.js"><link rel="prefetch" href="/JavaDocs/assets/js/84.4bace9fb.js"><link rel="prefetch" href="/JavaDocs/assets/js/85.941a21ea.js"><link rel="prefetch" href="/JavaDocs/assets/js/86.44d0a5db.js"><link rel="prefetch" href="/JavaDocs/assets/js/87.a3cc0a9a.js"><link rel="prefetch" href="/JavaDocs/assets/js/88.c7cb0514.js"><link rel="prefetch" href="/JavaDocs/assets/js/89.2e8f899e.js"><link rel="prefetch" href="/JavaDocs/assets/js/9.d8ad41ea.js"><link rel="prefetch" href="/JavaDocs/assets/js/90.659bef0e.js"><link rel="prefetch" href="/JavaDocs/assets/js/91.9bae00d1.js"><link rel="prefetch" href="/JavaDocs/assets/js/92.2fe625ea.js"><link rel="prefetch" href="/JavaDocs/assets/js/93.e2df25aa.js"><link rel="prefetch" href="/JavaDocs/assets/js/94.a8131976.js"><link rel="prefetch" href="/JavaDocs/assets/js/95.a6186740.js"><link rel="prefetch" href="/JavaDocs/assets/js/96.98de91eb.js"><link rel="prefetch" href="/JavaDocs/assets/js/97.694a94f5.js"><link rel="prefetch" href="/JavaDocs/assets/js/98.ed0080f8.js"><link rel="prefetch" href="/JavaDocs/assets/js/99.eb57622e.js">
    <link rel="stylesheet" href="/JavaDocs/assets/css/0.styles.c70d726d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/JavaDocs/" class="home-link router-link-active"><!----> <span class="site-name">JavaDocs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#课程内容">课程内容</a></li><li><a href="#_1-1-explain简介">1.1 Explain简介</a><ul><li><a href="#_1-1-1-id">1.1.1 id</a></li><li><a href="#_1-1-2-select-type">1.1.2 select_type</a></li><li><a href="#_1-1-3-table">1.1.3 table</a></li><li><a href="#_1-1-4-partitions">1.1.4 partitions</a></li><li><a href="#_1-1-5-type">1.1.5 type</a></li><li><a href="#_1-1-6-possible-keys">1.1.6 possible_keys</a></li><li><a href="#_1-1-7-key">1.1.7 key</a></li><li><a href="#_1-1-8-key-len">1.1.8 key_len</a></li><li><a href="#_1-1-9-ref">1.1.9 ref</a></li><li><a href="#_1-1-10-rows">1.1.10 rows</a></li><li><a href="#_1-1-11-filtered">1.1.11 filtered</a></li><li><a href="#_1-1-12-extra">1.1.12 Extra</a></li></ul></li><li><a href="#_1-2-注意事项">1.2 注意事项</a></li><li><a href="#_2-1-建表">2.1 建表</a></li><li><a href="#_2-2-设置参数">2.2 设置参数</a></li><li><a href="#_2-3-创建函数">2.3 创建函数</a></li><li><a href="#_2-4-创建存储过程">2.4 创建存储过程</a></li><li><a href="#_2-5-调用存储过程">2.5 调用存储过程</a></li><li><a href="#_3-1-索引失效">3.1 索引失效</a><ul><li><a href="#_3-3-1-全值匹配">3.3.1 全值匹配</a></li><li><a href="#_3-3-2-最左法则">3.3.2 最左法则</a></li><li><a href="#_3-3-3-计算、函数">3.3.3 计算、函数</a></li><li><a href="#_3-3-4-范围条件">3.3.4 范围条件</a></li><li><a href="#_3-3-5">3.3.5 !=  &lt;&gt;</a></li><li><a href="#_3-3-6-is-not-null与is-nully">3.3.6 is not null与is nully</a></li><li><a href="#_3-3-7-like">3.3.7 like</a></li><li><a href="#_3-3-8-类型转换">3.3.8 类型转换</a></li><li><a href="#_3-3-9-小结">3.3.9 小结</a></li></ul></li><li><a href="#_3-2-关联查询优化">3.2 关联查询优化</a><ul><li><a href="#_3-2-1-数据准备">3.2.1 数据准备</a></li><li><a href="#_3-2-2-left-join">3.2.2 left join</a></li><li><a href="#_3-2-3-inner-join">3.2.3 inner join</a></li><li><a href="#_3-2-4-小结">3.2.4 小结</a></li></ul></li><li><a href="#_3-3-子查询优化">3.3 子查询优化</a></li><li><a href="#_3-4-排序优化">3.4 排序优化</a><ul><li><a href="#_3-4-1-排序优化">3.4.1 排序优化</a></li><li><a href="#_3-4-2-案例实战">3.4.2 案例实战</a></li><li><a href="#_3-4-3-双路排序和单路排序">3.4.3 双路排序和单路排序</a></li><li><a href="#_3-4-4-order-by效率优化">3.4.4 Order By效率优化</a></li><li><a href="#_3-4-5-group-by优化">3.4.5 GROUP BY优化</a></li></ul></li><li><a href="#_3-5-覆盖索引">3.5 覆盖索引</a></li><li><a href="#_4-1-慢查询日志介绍">4.1 慢查询日志介绍</a></li><li><a href="#_4-2-查看及开启">4.2 查看及开启</a></li><li><a href="#_4-3-mysqldumpslow">4.3 mysqldumpslow</a></li></ul></div><p></p> <h1 id="mysql-day02"><a href="#mysql-day02" class="header-anchor">#</a> MySQL-day02</h1> <h2 id="课程内容"><a href="#课程内容" class="header-anchor">#</a> 课程内容</h2> <ul><li><strong>explain</strong></li> <li><strong>单表使用索引及常见索引失效</strong></li> <li><strong>查询优化</strong></li> <li><strong>排序分组优化</strong></li> <li><strong>覆盖索引优化</strong></li> <li><strong>慢查询日志</strong></li> <li><strong>View视图</strong></li> <li><strong>主从复制</strong></li></ul> <h1 id="_1-explain"><a href="#_1-explain" class="header-anchor">#</a> 1 Explain</h1> <p>MySQL中有专门负责优化SELECT语句的优化器模块，主要功能：通过计算分析系统中收集到的统计信息，为客户端请求的Query提供他认为最优的执行计划（他认为最优的数据检索方式，但不见得是DBA认为是最优的，这部分最耗费时间）</p> <p>当客户端向MySQL 请求一条Query，命令解析器模块完成请求分类，区别出是 SELECT 并转发给MySQL Query Optimizer时，MySQL Query Optimizer 首先会对整条Query进行优化，处理掉一些常量表达式的预算，直接换算成常量值。并对 Query 中的查询条件进行简化和转换，如去掉一些无用或显而易见的条件、结构调整等。然后分析 Query 中的 Hint 信息（如果有），看显示Hint信息是否可以完全确定该Query 的执行计划。如果没有 Hint 或Hint 信息还不足以完全确定执行计划，则会读取所涉及对象的统计信息，根据 Query 进行写相应的计算分析，然后再得出最后的执行计划。</p> <h2 id="_1-1-explain简介"><a href="#_1-1-explain简介" class="header-anchor">#</a> 1.1 Explain简介</h2> <p>使用EXPLAIN关键字可以模拟优化器执行SQL查询语句，从而知道MySQL是 如何处理你的SQL语句的。分析你的查询语句或是表结构的性能瓶颈。</p> <p>EXPLAIN功能: 表的读取顺序，数据读取操作的操作类型，哪些索引可以使用，哪些索引被实际使用，表之间的引用，每张表有多少行被优化器查询等内容。</p> <p>使用方式为：Explain + SQL语句</p> <p>EXPLAIN出来的信息有10列，分别是**==id、select_type、table、type、possible_keys、key、key_len、ref、rows、Extra==**</p> <p><strong>id: 选择标识符</strong></p> <p><strong>select_type: 表示查询的类型</strong></p> <p><strong>table: 输出结果集的表</strong></p> <p><strong>partitions: 匹配的分区</strong></p> <p><strong>type: 表示表的连接类型</strong></p> <p><strong>possible_keys: 表示查询时，可能使用的索引</strong></p> <p><strong>key: 表示实际使用的索引</strong></p> <p><strong>key_len: 索引字段的长度</strong></p> <p><strong>ref: 列与索引的比较</strong></p> <p><strong>rows: 扫描出的行数(估算的行数)</strong></p> <p><strong>filtered: 按表条件过滤的行百分比</strong></p> <p><strong>Extra: 执行情况的描述和说明</strong></p> <p>创建一下数据库表和数据，接下来进行explain的详细学习</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t1<span class="token punctuation">(</span>id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>content  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t2<span class="token punctuation">(</span>id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>content  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t3<span class="token punctuation">(</span>id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>content  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t4<span class="token punctuation">(</span>id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>content  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t1<span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'t1_'</span><span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t2<span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'t2_'</span><span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t3<span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'t3_'</span><span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
 <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t4<span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'t4_'</span><span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_1-1-1-id"><a href="#_1-1-1-id" class="header-anchor">#</a> 1.1.1 id</h3> <p>select查询的序列号,包含一组数字，表示查询中执行select子句或操作表的顺序, 三种情况</p> <ul><li>id相同，执行顺序由上至下</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">select</span> t1<span class="token punctuation">.</span>id<span class="token punctuation">,</span>t2<span class="token punctuation">.</span>id<span class="token punctuation">,</span>t3<span class="token punctuation">.</span>id<span class="token punctuation">,</span>t4<span class="token punctuation">.</span>id <span class="token keyword">from</span> t1<span class="token punctuation">,</span>t2<span class="token punctuation">,</span>t3<span class="token punctuation">,</span>t4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>id不同，如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span>
	t1<span class="token punctuation">.</span>id 
<span class="token keyword">FROM</span>
	t1 
<span class="token keyword">WHERE</span>
	t1<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> t2<span class="token punctuation">.</span>id <span class="token keyword">FROM</span> t2 <span class="token keyword">WHERE</span> t2<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> t3<span class="token punctuation">.</span>id <span class="token keyword">FROM</span> t3 <span class="token keyword">WHERE</span> t3<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">'t3_354'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>id相同，不同，同时存在</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span>
	t1<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token keyword">select</span> t4<span class="token punctuation">.</span>id <span class="token keyword">from</span> t4 <span class="token keyword">where</span> t4<span class="token punctuation">.</span>id <span class="token operator">=</span> t1<span class="token punctuation">.</span>id<span class="token punctuation">)</span>id4
<span class="token keyword">FROM</span>
	t1<span class="token punctuation">,</span>t2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>注意:</strong></p> <ul><li><strong>id如果相同，可以认为是一组，从上往下顺序执行</strong></li> <li><strong>在所有组中，id值越大，优先级越高，越先执行</strong></li> <li><strong>id号每个号码，表示一趟独立的查询, 一个sql的查询趟数越少越好</strong></li></ul> <h3 id="_1-1-2-select-type"><a href="#_1-1-2-select-type" class="header-anchor">#</a> 1.1.2 select_type</h3> <p><strong>SIMPLE</strong> : 简单的 select 查询,查询中不包含子查询或者UNION</p> <p><strong>PRIMARY</strong> :查询中若包含任何复杂的子部分，最外层查询则被标记为primary</p> <p><strong>SUBQUERY</strong>: 在SELECT或WHERE列表中包含了子查询</p> <p><strong>DEPENDENT SUBQUERY</strong>: 在SELECT或WHERE列表中包含了子查询,子查询基于外层</p> <p><strong>UNCACHEABLE SUBQUREY</strong>: 表示这个subquery的查询要受到外部表查询的影响</p> <p><strong>DERIVED</strong>: 在FROM列表中包含的子查询被标记为DERIVED(衍生) MySQL会递归执行这些子查询, 把结果放在临时表里</p> <p><strong>UNION</strong>: 这是UNION语句其中的一个SQL元素</p> <p><strong>UNION RESULT</strong>: 从UNION表获取结果的SELECT</p> <h3 id="_1-1-3-table"><a href="#_1-1-3-table" class="header-anchor">#</a> 1.1.3 table</h3> <p>显示这一步所访问数据库中表名称（显示这一行的数据是关于哪张表的），有时不是真实的表名字，可能是简称</p> <h3 id="_1-1-4-partitions"><a href="#_1-1-4-partitions" class="header-anchor">#</a> 1.1.4 partitions</h3> <p>代表分区表中的命中情况，非分区表，该项为null</p> <h3 id="_1-1-5-type"><a href="#_1-1-5-type" class="header-anchor">#</a> 1.1.5 type</h3> <p>对表访问方式，表示MySQL在表中找到所需行的方式，又称“访问类型”。</p> <p>常用的类型有： <strong>ALL、index、range、 ref、eq_ref、const、system、NULL（从左到右，性能从差到好）</strong></p> <p><strong>==ALL==</strong>: Full Table Scan， MySQL将遍历全表以找到匹配的行</p> <p><strong>==index==</strong>: Full Index Scan，index与ALL区别为index类型只遍历索引树, all和Index都是读全表，但index是从索引中读取的，而all是从硬盘中读的</p> <p><strong>==range==</strong>: 只检索给定范围的行，使用一个索引来选择行, <strong>范围索引扫描比全表扫描要好</strong>，因为它只需要开始于索引的某一点，而结束语另一点，不用扫描全部索引</p> <p><strong>==ref==</strong>:  表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</p> <p><strong>==eq_ref==</strong>: 类似ref，区别就在使用的索引是唯一索引，对于每个索引键值，表中只有一条记录匹配，简单来说，就是多表连接中使用primary key或者 unique key作为关联条件</p> <p><strong>==const==</strong>: 表示通过索引一次就找到了,const用于primary key或者unique索引, 因为只匹配一行数据，所以很快 如将主键置于where列表中，MySQL就能将该查询转换为一个常量</p> <p><strong>==system==</strong>: 表仅有一行记录，这是const类型的特例，查询起来非常迅速</p> <p><strong>==NULL==</strong>: MySQL在优化过程中分解语句，执行时甚至不用访问表或索引，例如从一个索引列里选取最小值可以通过单独索引查找完成。</p> <p>==<strong>备注：一般来说，得保证查询至少达到range级别，最好能达到ref。</strong>==</p> <h3 id="_1-1-6-possible-keys"><a href="#_1-1-6-possible-keys" class="header-anchor">#</a> 1.1.6 possible_keys</h3> <p>指出MySQL能使用哪个索引在表中找到记录，查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询使用（该查询可以利用的索引，如果没有任何索引显示 null）</p> <h3 id="_1-1-7-key"><a href="#_1-1-7-key" class="header-anchor">#</a> 1.1.7 key</h3> <p>key列显示MySQL实际决定使用的键（索引），必然包含在possible_keys中</p> <h3 id="_1-1-8-key-len"><a href="#_1-1-8-key-len" class="header-anchor">#</a> 1.1.8 key_len</h3> <p>key_len表示索引使用的字节数，根据这个值可以判断索引的使用情况，特别是在组合索引的时候，判断该索引有多少部分被使用到非常重要, 值越大索引的效果越好。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> t3<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>计算逻辑:</strong></p> <ul><li>先看索引上字段的类型+长度比如 int=4 ; varchar(20) =20 ; char(20) =20</li> <li>如果是varchar或者char这种字符串字段，视字符集要乘不同的值，比如utf-8要乘 3，GBK要乘2</li> <li>varchar这种动态字符串要加2个字节</li> <li>允许为空的字段要加1个字节</li></ul> <h3 id="_1-1-9-ref"><a href="#_1-1-9-ref" class="header-anchor">#</a> 1.1.9 ref</h3> <p>显示将哪些列或常量与键列中命名的索引进行比较，以从表中选择行</p> <h3 id="_1-1-10-rows"><a href="#_1-1-10-rows" class="header-anchor">#</a> 1.1.10 rows</h3> <p>估算出结果集行数，表示MySQL根据表统计信息及索引选用情况，估算的找到所需的记录所需要读取的行数</p> <h3 id="_1-1-11-filtered"><a href="#_1-1-11-filtered" class="header-anchor">#</a> 1.1.11 filtered</h3> <p>这个字段表示存储引擎返回的数据在server层过滤后，剩下多少满足查询的记录数量的比例，<strong>注意是百分比，不是具体记录数</strong></p> <h3 id="_1-1-12-extra"><a href="#_1-1-12-extra" class="header-anchor">#</a> 1.1.12 Extra</h3> <p>该列包含MySQL解决查询的详细信息,有以下几种情况：</p> <p>**Using where:**不用读取表中所有信息，仅通过索引就可以获取所需数据，这发生在对表的全部的请求列都是同一个索引的部分的时候，表示mysql服务器将在存储引擎检索行后再进行过滤</p> <p><strong>Using temporary</strong>：表示MySQL需要使用临时表来存储结果集，常见于排序和分组查询，常见 group by ; order by</p> <p><strong>Using filesort</strong>：当Query中包含 order by 操作，而且无法利用索引完成的排序操作称为“文件排序”</p> <p><strong>Using join buffer</strong>：改值强调了在获取连接条件时没有使用索引，并且需要连接缓冲区来存储中间结果。如果出现了这个值，那应该注意，根据查询的具体情况可能需要添加索引来改进能。</p> <p><strong>Impossible where</strong>：这个值强调了where语句会导致没有符合条件的行（通过收集统计信息不可能存在结果）。</p> <p><strong>Select tables optimized away</strong>：这个值意味着仅通过使用索引，优化器可能仅从聚合函数结果中返回一行</p> <p><strong>No tables used</strong>：Query语句中使用from dual 或不含任何from子句</p> <h2 id="_1-2-注意事项"><a href="#_1-2-注意事项" class="header-anchor">#</a> 1.2 注意事项</h2> <ul><li>EXPLAIN不会告诉你关于触发器、存储过程的信息或用户自定义函数对查询的影响情况</li> <li>EXPLAIN不考虑各种Cache</li> <li>EXPLAIN不能显示MySQL在执行查询时所作的优化工作</li> <li>部分统计信息是估算的，并非精确值</li> <li>EXPALIN只能解释SELECT操作，其他操作要重写为SELECT后查看执行计划</li></ul> <h1 id="_2-数据准备"><a href="#_2-数据准备" class="header-anchor">#</a> 2 数据准备</h1> <h2 id="_2-1-建表"><a href="#_2-1-建表" class="header-anchor">#</a> 2.1 建表</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>dept<span class="token punctuation">`</span> <span class="token punctuation">(</span>
 <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
 <span class="token punctuation">`</span>deptName<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token punctuation">`</span>address<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token punctuation">`</span>ceo<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
 
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>emp<span class="token punctuation">`</span> <span class="token punctuation">(</span>
 <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
 <span class="token punctuation">`</span>empno<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
 <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token punctuation">`</span>age<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token punctuation">`</span>deptId<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
 <span class="token comment">#CONSTRAINT `fk_dept_id` FOREIGN KEY (`deptId`) REFERENCES `t_dept` (`id`)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="_2-2-设置参数"><a href="#_2-2-设置参数" class="header-anchor">#</a> 2.2 设置参数</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>创建函数，假如报错：This <span class="token keyword">function</span> has none <span class="token keyword">of</span> <span class="token keyword">DETERMINISTIC</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment"># 由于开启过慢查询日志bin-log, 我们就必须为我们的function指定一个参数。</span>
<span class="token comment">#主从复制，主机会将写操作记录在bin-log日志中。从机读取bin-log日志，执行语句来同步数据。</span>
<span class="token comment">#如果使用函数来操作数据，会导致从机和主键操作时间不一致。所以，默认情况下，mysql不开启创建函数设置</span>
<span class="token comment">#查看mysql是否允许创建函数：</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'log_bin_trust_function_creators'</span><span class="token punctuation">;</span>
<span class="token comment">#命令开启：允许创建函数设置：</span>
<span class="token keyword">set</span> <span class="token keyword">global</span> log_bin_trust_function_creators<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment"># 不加global只是当前窗口有效。mysqld重启，上述参数又会消失。</span>
<span class="token comment">#永久方法：</span>
•windows下：my<span class="token punctuation">.</span>ini<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>加上：log_bin_trust_function_creators<span class="token operator">=</span><span class="token number">1</span>  
•linux下：<span class="token operator">/</span>etc<span class="token operator">/</span>my<span class="token punctuation">.</span>cnf下my<span class="token punctuation">.</span>cnf<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>加上：log_bin_trust_function_creators<span class="token operator">=</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_2-3-创建函数"><a href="#_2-3-创建函数" class="header-anchor">#</a> 2.3 创建函数</h2> <p>随机产生字符串</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> $$
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> rand_string<span class="token punctuation">(</span>n <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>    
<span class="token keyword">DECLARE</span> chars_str <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ'</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> return_str <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">WHILE</span> i <span class="token operator">&lt;</span> n <span class="token keyword">DO</span>  
<span class="token keyword">SET</span> return_str <span class="token operator">=</span>CONCAT<span class="token punctuation">(</span>return_str<span class="token punctuation">,</span>SUBSTRING<span class="token punctuation">(</span>chars_str<span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
<span class="token keyword">RETURN</span> return_str<span class="token punctuation">;</span>
<span class="token keyword">END</span> $$
 
<span class="token comment">#假如要删除</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">function</span> rand_string<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>随机产生部门编号</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#用于随机产生多少到多少的编号</span>
<span class="token keyword">DELIMITER</span> $$
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span>  rand_num <span class="token punctuation">(</span>from_num <span class="token keyword">INT</span> <span class="token punctuation">,</span>to_num <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>   
<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token keyword">SET</span> i <span class="token operator">=</span> FLOOR<span class="token punctuation">(</span>from_num <span class="token operator">+</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>to_num <span class="token operator">-</span> from_num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token punctuation">;</span>
<span class="token keyword">RETURN</span> i<span class="token punctuation">;</span>  
<span class="token keyword">END</span>$$ 
 
<span class="token comment">#假如要删除</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">function</span> rand_num<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_2-4-创建存储过程"><a href="#_2-4-创建存储过程" class="header-anchor">#</a> 2.4 创建存储过程</h2> <p>创建往emp表中插入数据的存储过程</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> $$
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span>  insert_emp<span class="token punctuation">(</span>  <span class="token keyword">START</span> <span class="token keyword">INT</span> <span class="token punctuation">,</span>  max_num <span class="token keyword">INT</span> <span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>  
<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>   
 <span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">#设置手动提交事务</span>
 <span class="token keyword">REPEAT</span>  <span class="token comment">#循环</span>
 <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">#赋值</span>
 <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp <span class="token punctuation">(</span>empno<span class="token punctuation">,</span> NAME <span class="token punctuation">,</span>age <span class="token punctuation">,</span>deptid <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">START</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>rand_string<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rand_num<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rand_num<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 UNTIL i <span class="token operator">=</span> max_num  
 <span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>  
 <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>  <span class="token comment">#提交事务</span>
<span class="token keyword">END</span>$$
 
<span class="token comment">#删除</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">PROCEDURE</span> insert_emp<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>创建往dept表中插入数据的存储过程</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#执行存储过程，往dept表添加随机数据</span>
<span class="token keyword">DELIMITER</span> $$
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> <span class="token punctuation">`</span>insert_dept<span class="token punctuation">`</span><span class="token punctuation">(</span>  max_num <span class="token keyword">INT</span> <span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>  
<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>   
 <span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    
 <span class="token keyword">REPEAT</span>  
 <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  
 <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dept <span class="token punctuation">(</span> deptname<span class="token punctuation">,</span>address<span class="token punctuation">,</span>ceo <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>rand_string<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rand_string<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rand_num<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">500000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 UNTIL i <span class="token operator">=</span> max_num  
 <span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>  
 <span class="token keyword">COMMIT</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span>$$
 
<span class="token comment">#删除</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">PROCEDURE</span> insert_dept<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>删除表上所有索引的存储过程</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> $$
<span class="token keyword">CREATE</span>  <span class="token keyword">PROCEDURE</span> <span class="token punctuation">`</span>proc_drop_index<span class="token punctuation">`</span><span class="token punctuation">(</span>dbname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>tablename <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
       <span class="token keyword">DECLARE</span> done <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">DECLARE</span> ct <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">DECLARE</span> _index <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">;</span>
       <span class="token keyword">DECLARE</span> _cur <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span>  <span class="token keyword">SELECT</span>   index_name   <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">STATISTICS</span>   <span class="token keyword">WHERE</span> table_schema<span class="token operator">=</span>dbname <span class="token operator">AND</span> table_name<span class="token operator">=</span>tablename <span class="token operator">AND</span> seq_in_index<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">AND</span>    index_name <span class="token operator">&lt;&gt;</span><span class="token string">'PRIMARY'</span>  <span class="token punctuation">;</span>
<span class="token comment">#每个游标必须使用不同的declare continue handler for not found set done=1来控制游标的结束</span>
       <span class="token keyword">DECLARE</span>  <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> <span class="token operator">NOT</span> FOUND <span class="token keyword">set</span> done<span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">;</span>      
<span class="token comment">#若没有数据返回,程序继续,并将变量done设为2</span>
        <span class="token keyword">OPEN</span> _cur<span class="token punctuation">;</span>
        <span class="token keyword">FETCH</span> _cur <span class="token keyword">INTO</span> _index<span class="token punctuation">;</span>
        <span class="token keyword">WHILE</span>  _index<span class="token operator">&lt;&gt;</span><span class="token string">''</span> <span class="token keyword">DO</span> 
               <span class="token keyword">SET</span> <span class="token variable">@str</span> <span class="token operator">=</span> CONCAT<span class="token punctuation">(</span><span class="token string">&quot;drop index &quot;</span> <span class="token punctuation">,</span> _index <span class="token punctuation">,</span> <span class="token string">&quot; on &quot;</span> <span class="token punctuation">,</span> tablename <span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token keyword">PREPARE</span> sql_str <span class="token keyword">FROM</span> <span class="token variable">@str</span> <span class="token punctuation">;</span>
               <span class="token keyword">EXECUTE</span>  sql_str<span class="token punctuation">;</span>
               <span class="token keyword">DEALLOCATE</span> <span class="token keyword">PREPARE</span> sql_str<span class="token punctuation">;</span>
               <span class="token keyword">SET</span> _index<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span> 
               <span class="token keyword">FETCH</span> _cur <span class="token keyword">INTO</span> _index<span class="token punctuation">;</span> 
        <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
   <span class="token keyword">CLOSE</span> _cur<span class="token punctuation">;</span>
<span class="token keyword">END</span>$$
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="_2-5-调用存储过程"><a href="#_2-5-调用存储过程" class="header-anchor">#</a> 2.5 调用存储过程</h2> <p>Dept</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#执行存储过程，往dept表添加1万条数据  </span>
<span class="token keyword">CALL</span> insert_dept<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Emp</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#执行存储过程，往emp表添加50万条数据  </span>
<span class="token keyword">CALL</span> insert_emp<span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">500000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h1 id="_3-sql优化"><a href="#_3-sql优化" class="header-anchor">#</a> 3 SQL优化</h1> <h2 id="_3-1-索引失效"><a href="#_3-1-索引失效" class="header-anchor">#</a> 3.1 索引失效</h2> <h3 id="_3-3-1-全值匹配"><a href="#_3-3-1-全值匹配" class="header-anchor">#</a> 3.3.1 全值匹配</h3> <p>系统中经常出现的sql语句如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">30</span> <span class="token operator">and</span> deptid<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">30</span> <span class="token operator">and</span> deptid<span class="token operator">=</span><span class="token number">4</span> <span class="token operator">AND</span> emp<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'abcd'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>思考: 索引应该如何建立 ？</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_age <span class="token keyword">ON</span> emp<span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_age_deptid <span class="token keyword">ON</span> emp<span class="token punctuation">(</span>age<span class="token punctuation">,</span>deptid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_age_deptid_name <span class="token keyword">ON</span> emp<span class="token punctuation">(</span>age<span class="token punctuation">,</span>deptid<span class="token punctuation">,</span>NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-3-2-最左法则"><a href="#_3-3-2-最左法则" class="header-anchor">#</a> 3.3.2 最左法则</h3> <p>如果系统经常出现的sql如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">30</span> <span class="token operator">AND</span> emp<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'abcd'</span> <span class="token punctuation">;</span>
或者
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>deptid<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">AND</span> emp<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'abcd'</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>==<strong>思考: 那原来的idx_age_deptid_name 还能否正常使用？</strong>==</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> deptid<span class="token operator">=</span><span class="token number">4</span> <span class="token operator">AND</span> emp<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">30</span> <span class="token operator">AND</span> emp<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'abcd'</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果索引了多列，要遵守最左前缀法则。指的是查询从索引的最左前列开始并且不跳过索引中的列。</p> <p>过滤条件要使用索引必须按照索引建立时的顺序，依次满足，一旦跳过某个字段，索引后面的字段都无法被使用。</p> <h3 id="_3-3-3-计算、函数"><a href="#_3-3-3-计算、函数" class="header-anchor">#</a> 3.3.3 计算、函数</h3> <p>模糊查询</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#创建索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> emp<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#函数模糊查询: 索引完全失效</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> <span class="token keyword">LEFT</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-3-4-范围条件"><a href="#_3-3-4-范围条件" class="header-anchor">#</a> 3.3.4 范围条件</h3> <p>出现的sql如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#索引 idx_age_deptid_name这个索引还能正常使用么？不能，范围右边的列不能使用</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">30</span> <span class="token operator">AND</span> emp<span class="token punctuation">.</span>deptId<span class="token operator">&gt;</span><span class="token number">20</span> <span class="token operator">AND</span> emp<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'abc'</span> <span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>索引优化:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#将范围查询条件放置语句最后</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> idx_age_name_deptid <span class="token keyword">on</span> emp<span class="token punctuation">(</span>age<span class="token punctuation">,</span>name<span class="token punctuation">,</span>deptid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>==<strong>注意: 应用开发中范围查询，例如： 金额查询，日期查询往往都是范围查询。应将查询条件放置where语句最后。</strong>==</p> <h3 id="_3-3-5"><a href="#_3-3-5" class="header-anchor">#</a> 3.3.5 !=  &lt;&gt;</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#为name字段创建索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> emp<span class="token punctuation">(</span>NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#执行查看索引是否失效</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>name <span class="token operator">&lt;&gt;</span> <span class="token string">'abc'</span> <span class="token punctuation">;</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-3-6-is-not-null与is-nully"><a href="#_3-3-6-is-not-null与is-nully" class="header-anchor">#</a> 3.3.6 is not null与is nully</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#IS NULL:可以触发索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> age <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span> 
<span class="token comment">#IS NOT NULL:无法触发索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> age <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-3-7-like"><a href="#_3-3-7-like" class="header-anchor">#</a> 3.3.7 like</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#下列哪个sql语句可以用到索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">'ab%'</span><span class="token punctuation">;</span> 
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">'%ab%'</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-3-8-类型转换"><a href="#_3-3-8-类型转换" class="header-anchor">#</a> 3.3.8 类型转换</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#下列哪个sql语句可以用到索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> name<span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">;</span> 
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> name<span class="token operator">=</span><span class="token string">'123'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-3-9-小结"><a href="#_3-3-9-小结" class="header-anchor">#</a> 3.3.9 小结</h3> <p>假设index(a,b,c)</p> <table><thead><tr><th>Where语句</th> <th>索引是否被使用</th></tr></thead> <tbody><tr><td>where a =  3</td> <td>Y,使用到a</td></tr> <tr><td>where a =  3 and b = 5</td> <td>Y,使用到a，b</td></tr> <tr><td>where a =  3 and b = 5 and c = 4</td> <td>Y,使用到a,b,c</td></tr> <tr><td>where b =  3 或者 where b = 3 and c =  4 或者 where c =  4</td> <td>N</td></tr> <tr><td>where a =  3 and c = 5</td> <td>使用到a， 但是c不可以，b中间断了</td></tr> <tr><td>where a =  3 and b &gt; 4 and c = 5</td> <td>使用到a和b， c不能用在范围之后，b断了</td></tr> <tr><td>where a is  null and b is not null</td> <td>is null 支持索引  但是is not null 不支持,所以 a 可以使用索引,但是 b不可以使用</td></tr> <tr><td>where a  &lt;&gt; 3</td> <td>不能使用索引</td></tr> <tr><td>where  abs(a) =3</td> <td>不能使用 索引</td></tr> <tr><td>where a =  3 and b like 'kk%' and c = 4</td> <td>Y,使用到a,b,c</td></tr> <tr><td>where a =  3 and b like '%kk' and c = 4</td> <td>Y,只用到a</td></tr> <tr><td>where a =  3 and b like '%kk%' and c = 4</td> <td>Y,只用到a</td></tr> <tr><td>where a =  3 and b like 'k%kk%' and c =  4</td> <td>Y,使用到a,b,c</td></tr></tbody></table> <p><strong>索引创建原则:</strong></p> <ul><li>对于单键索引，尽量选择过滤性更好的索引（例如：手机号，邮件，身份证）</li> <li>在选择组合索引的时候，过滤性最好的字段在索引字段顺序中，位置越靠前越好。</li> <li>选择组合索引时，尽量包含where中更多字段的索引</li> <li>组合索引出现范围查询时，尽量把这个字段放在索引次序的最后面</li> <li>尽量避免造成索引失效的情况</li> <li>拓展: 强制触发索引?mysql一张表最多创建多少个索引?</li></ul> <h2 id="_3-2-关联查询优化"><a href="#_3-2-关联查询优化" class="header-anchor">#</a> 3.2 关联查询优化</h2> <h3 id="_3-2-1-数据准备"><a href="#_3-2-1-数据准备" class="header-anchor">#</a> 3.2.1 数据准备</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#分类</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>class<span class="token punctuation">`</span> <span class="token punctuation">(</span>
<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>card<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#图书</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>book<span class="token punctuation">`</span> <span class="token punctuation">(</span>
<span class="token punctuation">`</span>bookid<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>card<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>bookid<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> class<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> book<span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h3 id="_3-2-2-left-join"><a href="#_3-2-2-left-join" class="header-anchor">#</a> 3.2.2 left join</h3> <p>下面开始explain分析</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> class <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> book <span class="token keyword">ON</span> class<span class="token punctuation">.</span>card <span class="token operator">=</span> book<span class="token punctuation">.</span>card<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>结论：type 有All</p> <p>添加索引优化</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> book <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> Y <span class="token punctuation">(</span>card<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> class <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> X <span class="token punctuation">(</span>card<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-2-3-inner-join"><a href="#_3-2-3-inner-join" class="header-anchor">#</a> 3.2.3 inner join</h3> <p>换成inner join（MySQL自动选择驱动表）</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span>  class <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> book <span class="token keyword">ON</span> class<span class="token punctuation">.</span>card<span class="token operator">=</span>book<span class="token punctuation">.</span>card<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加索引优化</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span>  <span class="token keyword">TABLE</span> book <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> Y <span class="token punctuation">(</span>card<span class="token punctuation">)</span><span class="token punctuation">;</span>  
或       
<span class="token keyword">ALTER</span>  <span class="token keyword">TABLE</span> class <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> X <span class="token punctuation">(</span>card<span class="token punctuation">)</span><span class="token punctuation">;</span>      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-2-4-小结"><a href="#_3-2-4-小结" class="header-anchor">#</a> 3.2.4 小结</h3> <ul><li>保证被驱动表的join字段被索引</li> <li>left join 时，选择小表作为驱动表，大表作为被驱动表</li> <li>inner join 时，mysql会自动将小结果集的表选为驱动表。</li> <li>子查询尽量不要放在被驱动表，衍生表建不了索引</li> <li>能够直接多表关联的尽量直接关联，不用子查询</li></ul> <h2 id="_3-3-子查询优化"><a href="#_3-3-子查询优化" class="header-anchor">#</a> 3.3 子查询优化</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#不推荐</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_emp a <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>id <span class="token operator">NOT</span> <span class="token operator">IN</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> b<span class="token punctuation">.</span>ceo <span class="token keyword">FROM</span> t_dept b <span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>ceo <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#推荐</span>
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> t_emp a 
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> t_dept b 
<span class="token keyword">ON</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>ceo 
<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_3-4-排序优化"><a href="#_3-4-排序优化" class="header-anchor">#</a> 3.4 排序优化</h2> <h3 id="_3-4-1-排序优化"><a href="#_3-4-1-排序优化" class="header-anchor">#</a> 3.4.1 排序优化</h3> <p><strong>order by时不限制索引失效</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#创建索引  </span>
<span class="token keyword">CREATE</span>  <span class="token keyword">INDEX</span> idx_age_deptid_name <span class="token keyword">ON</span> emp <span class="token punctuation">(</span>age<span class="token punctuation">,</span>deptid<span class="token punctuation">,</span>NAME<span class="token punctuation">)</span>
<span class="token comment">#不限制,索引失效</span>
<span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">ORDER</span>  <span class="token keyword">BY</span> age<span class="token punctuation">,</span>deptid<span class="token punctuation">;</span>   
<span class="token comment">#增加limit过滤条件，使用上索引了。</span>
<span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">ORDER</span>  <span class="token keyword">BY</span> age<span class="token punctuation">,</span>deptid <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>order by时顺序错误,索引失效</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#创建索引age,deptid,NAME</span>
<span class="token keyword">CREATE</span>  <span class="token keyword">INDEX</span> idx_age_deptid_name <span class="token keyword">ON</span> emp <span class="token punctuation">(</span>age<span class="token punctuation">,</span>deptid<span class="token punctuation">,</span>NAME<span class="token punctuation">)</span>
<span class="token comment">#创建索引age,deptid,empno</span>
<span class="token keyword">CREATE</span>  <span class="token keyword">INDEX</span> idx_age_deptid_empno <span class="token keyword">ON</span> emp <span class="token punctuation">(</span>age<span class="token punctuation">,</span>deptid<span class="token punctuation">,</span>empno<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">#以下哪些索引失效?</span>
<span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> age<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> deptid<span class="token punctuation">;</span>  
<span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> age<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> deptid<span class="token punctuation">,</span>NAME<span class="token punctuation">;</span>   
<span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> age<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> deptid<span class="token punctuation">,</span>empno<span class="token punctuation">;</span>  
<span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> age<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> NAME<span class="token punctuation">,</span>deptid<span class="token punctuation">;</span>  
<span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> deptid<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age<span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>order by时规则不一致, 索引失效</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> age<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> deptid <span class="token keyword">DESC</span><span class="token punctuation">,</span> NAME <span class="token keyword">DESC</span> <span class="token punctuation">;</span>  
<span class="token keyword">EXPLAIN</span>  <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> age<span class="token operator">=</span><span class="token number">45</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> deptid <span class="token keyword">ASC</span><span class="token punctuation">,</span> NAME <span class="token keyword">DESC</span> <span class="token punctuation">;</span>      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-4-2-案例实战"><a href="#_3-4-2-案例实战" class="header-anchor">#</a> 3.4.2 案例实战</h3> <p>执行案例前先清除emp上的索引，只留主键</p> <p><strong>场景:查询年龄为30岁的，且员工编号小于101000的用户，按用户名称排序</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> SQL_NO_CACHE <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> age <span class="token operator">=</span><span class="token number">30</span> <span class="token operator">AND</span> empno <span class="token operator">&lt;</span><span class="token number">101000</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> NAME <span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>type 是 ALL，即最坏的情况。Extra 里还出现了 Using filesort,也是最坏的情况。</p> <p>优化思路：</p> <p><strong>方案一: 尽量让where的过滤条件和排序使用上索引</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_age_empno_name <span class="token keyword">ON</span> emp <span class="token punctuation">(</span>age<span class="token punctuation">,</span>empno<span class="token punctuation">,</span>NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>方案二: 为了去掉filesort我们可以把索引建成</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#删除旧索引</span>
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> idx_age_empno_name <span class="token keyword">ON</span> emp
<span class="token comment">#创建新索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_age_name <span class="token keyword">ON</span> emp<span class="token punctuation">(</span>age<span class="token punctuation">,</span>NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>方案三: 选择范围过滤，放弃排序上的索引</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#删除旧索引</span>
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> idx_age_name <span class="token keyword">ON</span> emp<span class="token punctuation">;</span>
<span class="token comment">#创建新索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_age_empno <span class="token keyword">ON</span> emp<span class="token punctuation">(</span>age<span class="token punctuation">,</span>empno<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>==<strong>结论: filesort，而且type为range, 但是效率更高了,为什么?</strong>==</p> <p>原因：</p> <ul><li>两个索引同时存在，mysql自动选择最优的方案：（对于这个例子，mysql选择idx_age_empno），但是，随着数据量的变化，选择的索引也会随之变化的</li> <li>所有的排序都是在条件过滤之后才执行的，所以，如果条件过滤掉大部分数据的话，剩下几百几千条数据进行排序其实并不是很消耗性能，即使索引优化了排序，但实际提升性能很有限。 相对的 empno&lt;101000 这个条件，如果没有用到索引的话，要对几万条的数据进行扫描，这是非常消耗性能的，所以索引放在这个字段上性价比最高，是最优选择。</li></ul> <p>==<strong>小结(重点):</strong>==</p> <p><strong>当【范围条件】和【group by 或者 order by】的字段出现二选一时，优先观察条件字段的过滤数量，如果过滤的数据足够多，而需要排序的数据并不多时，优先把索引放在范围字段上。反之，亦然。</strong></p> <h3 id="_3-4-3-双路排序和单路排序"><a href="#_3-4-3-双路排序和单路排序" class="header-anchor">#</a> 3.4.3 双路排序和单路排序</h3> <p>排序的字段若如果不在索引列上，则filesort会有两种算法<strong>双路排序</strong>和<strong>单路排序</strong></p> <p><strong>双路排序</strong></p> <p>MySQL 4.1之前是使用双路排序，字面意思就是两次扫描磁盘，最终得到数据， 读取行指针和order by列，对他们进行排序，然后扫描已经排序好的列表，按照列表中的值重新从列表中读取对应的数据输出, 从磁盘取排序字段，在buffer进行排序，再从磁盘取其他字段。取一批数据，要对磁盘进行两次扫描，众所周知，I\O是很耗时的，所以在mysql4.1之后，出现了第二种改进的算法，就是单路排序。</p> <p><strong>单路排序</strong></p> <p>从磁盘读取查询需要的所有列，按照order by列在buffer对它们进行排序，然后扫描排序后的列表进行输出， 它的效率更快一些，避免了第二次读取数据。并且把随机IO变成了顺序IO，但是它会使用更多的空间， 因为它把每一行都保存在内存中了。</p> <p><strong>单路排序存在的问题</strong></p> <p>在sort_buffer中，单路比多路要多占用很多空间，因为单路是把所有字段都取出, 所以有可能取出的数据的总大小超出了sort_buffer的容量，导致每次只能取sort_buffer容量大小的数据，进行排序（创建tmp文件，多路合并），排完再取sort_buffer容量大小，再排……从而多次I/O。单路本来想省一次I/O操作，反而导致了大量的I/O操作，反而得不偿失。优化策略如下:</p> <ul><li><p>增大sort_buffer_size参数的设置</p></li> <li><p>增大max_length_for_sort_data参数的设置</p></li> <li><p>减少select 后面的查询的字段</p></li></ul> <h3 id="_3-4-4-order-by效率优化"><a href="#_3-4-4-order-by效率优化" class="header-anchor">#</a> 3.4.4 Order By效率优化</h3> <ol><li><p>Order by时select * 是一个大忌</p> <ul><li>当Query的字段大小总和小于max_length_for_sort_data 而且排序字段不是TEXT|BLOB 类型时，会用单路排序，否则用多路排序</li> <li>两种算法的数据都有可能超出sort_buffer的容量，超出之后，会创建tmp文件进行合并排序，导致多次I/O，但是用单路排序算法的风险会更大一些，所以要提高sort_buffer_size</li></ul></li> <li><p>尝试提高 sort_buffer_size</p> <ul><li>不管用哪种算法，提高这个参数都会提高效率，要根据系统的能力去提高，因为这个参数是针对每个进程（connection）的 1M-8M之间调整。 MySQL5.7，InnoDB存储引擎默认值是1048576字节，1MB。</li></ul></li> <li><p>尝试提高 max_length_for_sort_data</p> <ul><li>提高这个参数， 会增加用改进算法的概率。</li> <li>但是如果设的太高，数据总容量超出sort_buffer_size的概率就增大，明显症状是高的磁盘I/O活动和低的处理器使用率。如果需要返回的列的总长度大于max_length_for_sort_data，使用双路算法，否则使用单路算法。1024-8192字节之间调整</li></ul></li></ol> <h3 id="_3-4-5-group-by优化"><a href="#_3-4-5-group-by优化" class="header-anchor">#</a> 3.4.5 GROUP BY优化</h3> <p>group by 使用索引的原则几乎跟order by一致 ，唯一区别：</p> <ul><li><p>group by 先排序再分组，遵照索引建的最佳左前缀法则</p></li> <li><p>当无法使用索引列，增大max_length_for_sort_data和sort_buffer_size参数的设置</p></li> <li><p>where高于having, 能写在where限定的条件就不要写在having中了</p></li></ul> <h2 id="_3-5-覆盖索引"><a href="#_3-5-覆盖索引" class="header-anchor">#</a> 3.5 覆盖索引</h2> <p><strong>理解方式一</strong>：索引是高效找到行的一个方法，但是一般数据库也能使用索引找到一个列的数据，因此它不必读取整个行。毕竟索引叶子节点存储了它们索引的数据；当能通过读取索引就可以得到想要的数据，那就不需要读取行了。<strong>==一个索引包含了满足查询结果的数据就叫做覆盖索引==</strong></p> <p><strong>理解方式二</strong>：非聚集复合索引的一种形式，它包括在查询里的Select、Join和Where子句用到的所有列（即建索引的字段正好是覆盖查询条件中所涉及的字段，也即，索引包含了查询正在查找的数据）。</p> <h1 id="_4-慢查询日志"><a href="#_4-慢查询日志" class="header-anchor">#</a> 4 慢查询日志</h1> <h2 id="_4-1-慢查询日志介绍"><a href="#_4-1-慢查询日志介绍" class="header-anchor">#</a> 4.1 慢查询日志介绍</h2> <p>MySQL的慢查询日志是MySQL提供的一种日志记录，它用来记录在MySQL中响应时间超过阀值的语句，具体指运行时间超过long_query_time值的SQL，则会被记录到慢查询日志中。 long_query_time的默认值为10，意思是运行10秒以上的语句。 由他来查看哪些SQL超出了我们的最大忍耐时间值，比如一条sql执行超过5秒钟，我们就算慢SQL，希望能收集超过5秒的sql，结合之前explain进行全面分析。</p> <p>默认情况下，MySQL数据库没有开启慢查询日志，需要我们手动来设置这个参数。</p> <p><strong>如果不是调优需要的话，一般不建议启动该参数，因为开启慢查询日志会或多或少带来一定的性能影响。慢查询日志支持将日志记录写入文件。</strong></p> <h2 id="_4-2-查看及开启"><a href="#_4-2-查看及开启" class="header-anchor">#</a> 4.2 查看及开启</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#默认情况下slow_query_log的值为OFF</span>
<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%slow_query_log%'</span><span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>命令行开启：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">global</span> slow_query_log<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>慢查询日志记录long_query_time时间</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'long_query_time'</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> long_query_time<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>注意: 运行时间正好等于long_query_time的情况，并不会被记录下来。</strong></p> <p>永久生效</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">修改my.cnf文件，[mysqld]下增加或修改参数slow_query_log</span> <span class="token attr-value">和slow_query_log_file后，然后重启MySQL服务器。也即将如下两行配置进my.cnf文件 </span>
<span class="token attr-name">slow_query_log</span> <span class="token punctuation">=</span><span class="token attr-value">1</span>
<span class="token attr-name">slow_query_log_file</span><span class="token punctuation">=</span><span class="token attr-value">/var/lib/mysql/atguigu-slow.log </span>
<span class="token attr-name">long_query_time</span><span class="token punctuation">=</span><span class="token attr-value">3</span>
<span class="token attr-name">log_output</span><span class="token punctuation">=</span><span class="token attr-value">FILE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>查询当前系统中有多少条慢查询记录</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'%Slow_queries%'</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_4-3-mysqldumpslow"><a href="#_4-3-mysqldumpslow" class="header-anchor">#</a> 4.3 mysqldumpslow</h2> <p>在生产环境中，如果要手工分析日志，查找、分析SQL，显然是个体力活，MySQL提供了日志分析工具mysqldumpslow。</p> <p>-a: 不将数字抽象成N，字符串抽象成S</p> <p>-s: 是表示按照何种方式排序；</p> <p>c: 访问次数</p> <p>l: 锁定时间</p> <p>r: 返回记录</p> <p>t: 查询时间</p> <p>al:平均锁定时间</p> <p>ar:平均返回记录数</p> <p>at:平均查询时间</p> <p>-t: 即为返回前面多少条的数据；</p> <p>-g: 后边搭配一个正则匹配模式，大小写不敏感的；</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#得到返回记录集最多的10个SQL</span>
mysqldumpslow <span class="token operator">-</span>s r <span class="token operator">-</span>t <span class="token number">10</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>slow<span class="token punctuation">.</span>log
<span class="token comment">#得到访问次数最多的10个SQL</span>
mysqldumpslow <span class="token operator">-</span>s c <span class="token operator">-</span>t <span class="token number">10</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>slow<span class="token punctuation">.</span>log
<span class="token comment">#得到按照时间排序的前10条里面含有左连接的查询语句</span>
mysqldumpslow <span class="token operator">-</span>s t <span class="token operator">-</span>t <span class="token number">10</span> <span class="token operator">-</span>g <span class="token string">&quot;left join&quot;</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>slow<span class="token punctuation">.</span>log
<span class="token comment">#另外建议在使用这些命令时结合 | 和more 使用 ，否则有可能出现爆屏情况</span>
mysqldumpslow <span class="token operator">-</span>s r <span class="token operator">-</span>t <span class="token number">10</span> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>atguigu<span class="token operator">-</span>slow<span class="token punctuation">.</span>log <span class="token operator">|</span> more
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h1 id="_5-view视图"><a href="#_5-view视图" class="header-anchor">#</a> 5 View视图</h1> <p>视图是将一段查询sql封装为一个虚拟的表。 这个虚拟表只保存了sql逻辑，不会保存任何查询结果。</p> <p><strong>主要作用:</strong></p> <ul><li>封装复杂sql语句，提高复用性</li> <li>逻辑放在数据库上面，更新不需要发布程序，面对频繁的需求变更更灵活</li></ul> <p><strong>常用场景:</strong></p> <ul><li>共用查询结果</li> <li>报表</li></ul> <p><strong>语法:</strong></p> <p>创建</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_name <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name  <span class="token keyword">WHERE</span> condition  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#查询</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> view_name 
<span class="token comment">#更新</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> view_name 
<span class="token keyword">AS</span> <span class="token keyword">SELECT</span> column_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">FROM</span> table_name <span class="token keyword">WHERE</span> condition
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h1 id="笔记"><a href="#笔记" class="header-anchor">#</a> 笔记</h1> <p>3.3.4 范围条件这个有问题，将索引创建后，并且范围放到最后索引并没有全部命中</p> <p>小表驱动？</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/JavaDocs/assets/js/app.658ffc6e.js" defer></script><script src="/JavaDocs/assets/js/6.f90b4eae.js" defer></script><script src="/JavaDocs/assets/js/428.900d8293.js" defer></script>
  </body>
</html>

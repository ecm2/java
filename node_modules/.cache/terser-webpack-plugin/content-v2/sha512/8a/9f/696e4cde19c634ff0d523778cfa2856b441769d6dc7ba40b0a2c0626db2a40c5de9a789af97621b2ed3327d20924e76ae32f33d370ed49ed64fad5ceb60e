{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[309],{709:function(t,a,s){\"use strict\";s.r(a);var n=s(44),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[s(\"p\",[t._v(\"[TOC]\")]),t._v(\" \"),s(\"h1\",{attrs:{id:\"第二节-声明式事务概念\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第二节-声明式事务概念\"}},[t._v(\"#\")]),t._v(\" 第二节 声明式事务概念\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"_1、编程式事务\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1、编程式事务\"}},[t._v(\"#\")]),t._v(\" 1、编程式事务\")]),t._v(\" \"),s(\"p\",[t._v(\"事务功能的相关操作全部通过自己编写代码来实现：\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"Connection\")]),t._v(\" conn \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"try\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 开启事务：关闭事务的自动提交\")]),t._v(\"\\n\\tconn\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"setAutoCommit\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token boolean\"}},[t._v(\"false\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 核心操作\")]),t._v(\"\\n\\t\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 提交事务\")]),t._v(\"\\n\\tconn\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"commit\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"catch\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"Exception\")]),t._v(\" e\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 回滚事务\")]),t._v(\"\\n\\tconn\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"rollBack\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"finally\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 释放数据库连接\")]),t._v(\"\\n\\tconn\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"close\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"编程式的实现方式存在缺陷：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"细节没有被屏蔽：具体操作过程中，所有细节都需要程序员自己来完成，比较繁琐。\")]),t._v(\" \"),s(\"li\",[t._v(\"代码复用性不高：如果没有有效抽取出来，每次实现功能都需要自己编写代码，代码就没有得到复用。\")])]),t._v(\" \"),s(\"h2\",{attrs:{id:\"_2、声明式事务\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2、声明式事务\"}},[t._v(\"#\")]),t._v(\" 2、声明式事务\")]),t._v(\" \"),s(\"p\",[t._v(\"既然事务控制的代码有规律可循，代码的结构基本是确定的，所以框架就可以将固定模式的代码抽取出来，进行相关的封装。\")]),t._v(\" \"),s(\"p\",[t._v(\"封装起来后，我们只需要在配置文件中进行简单的配置即可完成操作。\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"好处1：提高开发效率\")]),t._v(\" \"),s(\"li\",[t._v(\"好处2：消除了冗余的代码\")]),t._v(\" \"),s(\"li\",[t._v(\"好处3：框架会综合考虑相关领域中在实际开发环境下有可能遇到的各种问题，进行了健壮性、性能等各个方面的优化\")])]),t._v(\" \"),s(\"p\",[t._v(\"所以，我们可以总结下面两个概念：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[s(\"span\",{staticStyle:{color:\"blue\",\"font-weight\":\"bold\"}},[t._v(\"编程式\")]),t._v(\"：\"),s(\"span\",{staticStyle:{color:\"blue\",\"font-weight\":\"bold\"}},[t._v(\"自己写代码\")]),t._v(\"实现功能\")]),t._v(\" \"),s(\"li\",[s(\"span\",{staticStyle:{color:\"blue\",\"font-weight\":\"bold\"}},[t._v(\"声明式\")]),t._v(\"：通过\"),s(\"span\",{staticStyle:{color:\"blue\",\"font-weight\":\"bold\"}},[t._v(\"配置\")]),t._v(\"让\"),s(\"span\",{staticStyle:{color:\"blue\",\"font-weight\":\"bold\"}},[t._v(\"框架\")]),t._v(\"实现功能\")])]),t._v(\" \"),s(\"h2\",{attrs:{id:\"_3、事务管理器\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3、事务管理器\"}},[t._v(\"#\")]),t._v(\" 3、事务管理器\")]),t._v(\" \"),s(\"h3\",{attrs:{id:\"_1顶级接口\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1顶级接口\"}},[t._v(\"#\")]),t._v(\" ①顶级接口\")]),t._v(\" \"),s(\"h4\",{attrs:{id:\"_1-spring-5-2以前\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-spring-5-2以前\"}},[t._v(\"#\")]),t._v(\" [1]Spring 5.2以前\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"interface\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"PlatformTransactionManager\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TransactionStatus\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"getTransaction\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TransactionDefinition\")]),t._v(\" definition\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"throws\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TransactionException\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"void\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"commit\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TransactionStatus\")]),t._v(\" status\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"throws\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TransactionException\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"void\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"rollback\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TransactionStatus\")]),t._v(\" status\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"throws\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TransactionException\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"h4\",{attrs:{id:\"_2-从-spring-5-2开始\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-从-spring-5-2开始\"}},[t._v(\"#\")]),t._v(\" [2]从 Spring 5.2开始\")]),t._v(\" \"),s(\"p\",[t._v(\"PlatformTransactionManager 接口本身没有变化，它继承了 TransactionManager\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"interface\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"TransactionManager\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    \\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"blockquote\",[s(\"p\",[t._v(\"TransactionManager接口中什么都没有，但是它还是有存在的意义——定义一个技术体系。\")])]),t._v(\" \"),s(\"h3\",{attrs:{id:\"_2技术体系\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2技术体系\"}},[t._v(\"#\")]),t._v(\" ②技术体系\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"images/img001.png\",alt:\"images\"}})]),t._v(\" \"),s(\"p\",[t._v(\"我们现在要使用的事务管理器是org.springframework.jdbc.datasource.\"),s(\"span\",{staticStyle:{color:\"blue\",\"font-weight\":\"bold\"}},[t._v(\"DataSourceTransactionManager\")]),t._v(\"，将来整合 Mybatis 用的也是这个类。\")]),t._v(\" \"),s(\"p\",[t._v(\"DataSourceTransactionManager类中的主要方法：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"doBegin()：开启事务\")]),t._v(\" \"),s(\"li\",[t._v(\"doSuspend()：挂起事务\")]),t._v(\" \"),s(\"li\",[t._v(\"doResume()：恢复挂起的事务\")]),t._v(\" \"),s(\"li\",[t._v(\"doCommit()：提交事务\")]),t._v(\" \"),s(\"li\",[t._v(\"doRollback()：回滚事务\")])]),t._v(\" \"),s(\"p\",[s(\"RouterLink\",{attrs:{to:\"/pro004-Spring/lecture/chapter03/verse01.html\"}},[t._v(\"上一节\")]),t._v(\" \"),s(\"RouterLink\",{attrs:{to:\"/pro004-Spring/lecture/chapter03/index.html\"}},[t._v(\"回目录\")]),t._v(\" \"),s(\"RouterLink\",{attrs:{to:\"/pro004-Spring/lecture/chapter03/verse03.html\"}},[t._v(\"下一节\")])],1)])}),[],!1,null,null,null);a.default=e.exports}}]);","extractedComments":[]}
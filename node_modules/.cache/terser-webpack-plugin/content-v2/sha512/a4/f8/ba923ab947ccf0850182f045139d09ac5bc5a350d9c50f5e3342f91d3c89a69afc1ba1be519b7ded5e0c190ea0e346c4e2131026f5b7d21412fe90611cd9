{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[370],{1618:function(t,a,s){\"use strict\";s.r(a);var n=s(44),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[s(\"p\",[t._v(\"[TOC]\")]),t._v(\" \"),s(\"h1\",{attrs:{id:\"实验五-事务属性-回滚和不回滚的异常\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#实验五-事务属性-回滚和不回滚的异常\"}},[t._v(\"#\")]),t._v(\" 实验五 事务属性：回滚和不回滚的异常\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"_1、默认情况\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1、默认情况\"}},[t._v(\"#\")]),t._v(\" 1、默认情况\")]),t._v(\" \"),s(\"p\",[t._v(\"默认只针对运行时异常回滚，编译时异常不回滚。情景模拟代码如下：\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"void\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"updateEmpSalaryById\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"Integer\")]),t._v(\" empId\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"Double\")]),t._v(\" salary\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"throws\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"FileNotFoundException\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    \\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 为了看到操作失败后的效果人为将 SQL 语句破坏\")]),t._v(\"\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"String\")]),t._v(\" sql \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"update t_emp set emp_salary=? where emp_id=?\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\tjdbcTemplate\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"update\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"sql\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" salary\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" empId\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n    \\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"//  抛出编译时异常测试是否回滚\")]),t._v(\"\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"FileInputStream\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"aaaa.aaa\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n    \\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"//  抛出运行时异常测试是否回滚\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"//  System.out.println(10 / 0);\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),s(\"h2\",{attrs:{id:\"_2、设置回滚的异常\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2、设置回滚的异常\"}},[t._v(\"#\")]),t._v(\" 2、设置回滚的异常\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"rollbackFor属性：需要设置一个Class类型的对象\")]),t._v(\" \"),s(\"li\",[t._v(\"rollbackForClassName属性：需要设置一个字符串类型的全类名\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Transactional\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"rollbackFor \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"Exception\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"class\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\")])])]),s(\"h2\",{attrs:{id:\"_3、设置不回滚的异常\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3、设置不回滚的异常\"}},[t._v(\"#\")]),t._v(\" 3、设置不回滚的异常\")]),t._v(\" \"),s(\"p\",[t._v(\"在默认设置和已有设置的基础上，再指定一个异常类型，碰到它不回滚。\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[t._v(\"    \"),s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Transactional\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"\\n            noRollbackFor \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"FileNotFoundException\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"class\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\")])])]),s(\"h2\",{attrs:{id:\"_4、回滚和不回滚异常同时设置\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4、回滚和不回滚异常同时设置\"}},[t._v(\"#\")]),t._v(\" 4、回滚和不回滚异常同时设置\")]),t._v(\" \"),s(\"h3\",{attrs:{id:\"_1范围不同\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1范围不同\"}},[t._v(\"#\")]),t._v(\" ①范围不同\")]),t._v(\" \"),s(\"p\",[t._v(\"不管是哪个设置范围大，都是在大范围内在排除小范围的设定。例如：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"rollbackFor = Exception.class\")]),t._v(\" \"),s(\"li\",[t._v(\"noRollbackFor = FileNotFoundException.class\")])]),t._v(\" \"),s(\"p\",[t._v(\"意思是除了 FileNotFoundException 之外，其他所有 Exception 范围的异常都回滚；但是碰到 FileNotFoundException 不回滚。\")]),t._v(\" \"),s(\"h3\",{attrs:{id:\"_2范围一致\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2范围一致\"}},[t._v(\"#\")]),t._v(\" ②范围一致\")]),t._v(\" \"),s(\"p\",[t._v(\"回滚和不回滚的异常设置了相同范围（这是有多想不开）：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"noRollbackFor = FileNotFoundException.class\")]),t._v(\" \"),s(\"li\",[t._v(\"rollbackFor = FileNotFoundException.class\")])]),t._v(\" \"),s(\"p\",[t._v(\"此时 Spring 采纳了 rollbackFor 属性的设定：遇到 FileNotFoundException 异常会回滚。\")]),t._v(\" \"),s(\"p\",[s(\"RouterLink\",{attrs:{to:\"/pro004-Spring/lecture/chapter03/verse03/experiment04.html\"}},[t._v(\"上一个实验\")]),t._v(\" \"),s(\"RouterLink\",{attrs:{to:\"/pro004-Spring/lecture/chapter03/verse03.html\"}},[t._v(\"回目录\")]),t._v(\" \"),s(\"RouterLink\",{attrs:{to:\"/pro004-Spring/lecture/chapter03/verse03/experiment06.html\"}},[t._v(\"下一个实验\")])],1)])}),[],!1,null,null,null);a.default=e.exports}}]);","extractedComments":[]}